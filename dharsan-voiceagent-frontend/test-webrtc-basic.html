<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebRTC Basic Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>WebRTC Basic Connection Test</h1>
    <button onclick="testWebRTC()">Test WebRTC Connection</button>
    <button onclick="testMediaAccess()">Test Media Access</button>
    <div id="logs" class="log"></div>

    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            logs.innerHTML += '<div>' + new Date().toLocaleTimeString() + ': ' + message + '</div>';
            console.log(message);
        }

        async function testMediaAccess() {
            try {
                log('üé§ Testing media access...');
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true,
                        sampleRate: 48000
                    }
                });
                log('‚úÖ Media access successful!');
                log('üìä Tracks: ' + stream.getTracks().map(t => `${t.kind} (${t.id})`).join(', '));
                
                // Stop the stream
                stream.getTracks().forEach(track => track.stop());
                log('üõë Media stream stopped');
            } catch (error) {
                log('‚ùå Media access failed: ' + error.message);
            }
        }

        async function testWebRTC() {
            try {
                log('üîó Testing WebRTC connection...');
                
                // Create peer connection
                const peerConnection = new RTCPeerConnection({
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' }
                    ]
                });
                
                log('üì° Peer connection created');
                
                // Add event listeners
                peerConnection.onconnectionstatechange = () => {
                    log('üîÑ Connection state: ' + peerConnection.connectionState);
                };
                
                peerConnection.oniceconnectionstatechange = () => {
                    log('üßä ICE connection state: ' + peerConnection.iceConnectionState);
                };
                
                peerConnection.onicegatheringstatechange = () => {
                    log('üîç ICE gathering state: ' + peerConnection.iceGatheringState);
                };
                
                peerConnection.onicecandidate = (event) => {
                    if (event.candidate) {
                        log('üéØ ICE candidate: ' + event.candidate.candidate);
                    } else {
                        log('‚úÖ ICE gathering complete');
                    }
                };
                
                // Get media stream
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true,
                        sampleRate: 48000
                    }
                });
                
                log('üé§ Media stream obtained');
                
                // Add tracks to peer connection
                stream.getTracks().forEach(track => {
                    log('‚ûï Adding track: ' + track.kind);
                    peerConnection.addTrack(track, stream);
                });
                
                // Create offer
                log('üìù Creating offer...');
                const offer = await peerConnection.createOffer();
                log('üìÑ Offer created: ' + offer.type);
                
                // Set local description
                await peerConnection.setLocalDescription(offer);
                log('üìã Local description set');
                
                // Wait a bit to see state changes
                setTimeout(() => {
                    log('‚è∞ Final states after 3 seconds:');
                    log('   Connection: ' + peerConnection.connectionState);
                    log('   ICE Connection: ' + peerConnection.iceConnectionState);
                    log('   ICE Gathering: ' + peerConnection.iceGatheringState);
                    log('   Signaling: ' + peerConnection.signalingState);
                    
                    // Cleanup
                    peerConnection.close();
                    stream.getTracks().forEach(track => track.stop());
                    log('üßπ Cleanup complete');
                }, 3000);
                
            } catch (error) {
                log('‚ùå WebRTC test failed: ' + error.message);
            }
        }
    </script>
</body>
</html> 